<div class="explore container">
  <h1 class="explore__title">Explora les dades</h1>

  <p class="explore__text">
    Aquí pots filtrar la cerca mitjançant la combinació que vulguis dels
    selectors d'espècie, localització, quantitat d'individus, any, dates
    concretes, edat, província i sexe; i a continuació es mostraran la taula, el
    mapa i els gràfics relatius.
  </p>

  <section class="explore__form">
    <mat-card class="explore__form__card">
      <div class="explore__form__card__inner">
        <div class="explore__form__card__item">
          <mat-card-header class="explore__form__card__header">
            <mat-card-title>Espècie</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-form-field class="explore__form__card__field">
              <mat-label>Espècie</mat-label>
              <input
                matInput
                [matAutocomplete]="autoSpecies"
                [formControl]="controlSpecies"
              />
              <mat-autocomplete #autoSpecies="matAutocomplete">
                <mat-option
                  *ngFor="let option of filteredOptionsSpecies | async"
                  [value]="option"
                >
                  {{ option }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </mat-card-content>
        </div>

        <div class="explore__form__card__item">
          <mat-card-header class="explore__form__card__header">
            <mat-card-title>Localització</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-form-field class="explore__form__card__field">
              <mat-label>Localització</mat-label>
              <input
                matInput
                [matAutocomplete]="autoLocation"
                [formControl]="controlLocation"
              />
              <mat-autocomplete #autoLocation="matAutocomplete">
                <mat-option
                  *ngFor="let option of filteredOptionsLocation | async"
                  [value]="option"
                >
                  {{ option }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </mat-card-content>
        </div>

        <div class="explore__form__card__item">
          <mat-card-header class="explore__form__card__header">
            <mat-card-title>Quantitat</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-form-field class="explore__form__card__field">
              <mat-label>Quantitat</mat-label>
              <input
                matInput
                [matAutocomplete]="autoAmount"
                [formControl]="controlAmount"
              />
              <mat-autocomplete #autoAmount="matAutocomplete">
                <mat-option
                  *ngFor="let option of filteredOptionsAmount | async"
                  [value]="option"
                >
                  {{ option }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </mat-card-content>
        </div>

        <div class="explore__form__card__item">
          <mat-card-header class="explore__form__card__header">
            <mat-card-title>Any</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-form-field class="explore__form__card__field">
              <mat-label>Any</mat-label>
              <input
                matInput
                [matAutocomplete]="autoYear"
                [formControl]="controlYear"
              />
              <mat-autocomplete #autoYear="matAutocomplete">
                <mat-option
                  *ngFor="let option of filteredOptionsYear | async"
                  [value]="option"
                >
                  {{ option }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </mat-card-content>
        </div>

        <div class="explore__form__card__item">
          <mat-card-header class="explore__form__card__header">
            <mat-card-title>Per dates concretes</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-form-field class="explore__form__card__field">
              <mat-label>Selecciona un període</mat-label>
              <mat-date-range-input
                [formGroup]="dateRangeForm"
                [rangePicker]="picker"
              >
                <input
                  matStartDate
                  formControlName="start"
                  placeholder="Inici"
                />
                <input matEndDate formControlName="end" placeholder="Fi" />
              </mat-date-range-input>
              <mat-datepicker-toggle
                matIconSuffix
                [for]="picker"
              ></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
          </mat-card-content>
        </div>

        <div class="explore__form__card__item">
          <mat-card-header class="explore__form__card__header">
            <mat-card-title>Edat</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-form-field class="explore__form__card__field">
              <mat-label>Edat</mat-label>
              <input
                matInput
                [matAutocomplete]="autoAge"
                [formControl]="controlAge"
              />
              <mat-autocomplete #autoAge="matAutocomplete">
                <mat-option
                  *ngFor="let option of filteredOptionsAge | async"
                  [value]="option"
                >
                  {{ option }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </mat-card-content>
        </div>

        <div class="explore__form__card__item">
          <mat-card-header class="explore__form__card__header">
            <mat-card-title>Província</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-form-field class="explore__form__card__field">
              <mat-label>Província</mat-label>
              <input
                matInput
                [matAutocomplete]="autoProvince"
                [formControl]="controlProvince"
              />
              <mat-autocomplete #autoProvince="matAutocomplete">
                <mat-option
                  *ngFor="let option of filteredOptionsProvince | async"
                  [value]="option"
                >
                  {{ option }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </mat-card-content>
        </div>

        <div class="explore__form__card__item">
          <mat-card-header class="explore__form__card__header">
            <mat-card-title>Sexe</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-form-field class="explore__form__card__field">
              <mat-label>Sexe</mat-label>
              <input
                matInput
                [matAutocomplete]="autoSex"
                [formControl]="controlSex"
              />
              <mat-autocomplete #autoSex="matAutocomplete">
                <mat-option
                  *ngFor="let option of filteredOptionsSex | async"
                  [value]="option"
                >
                  {{ option }}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </mat-card-content>
        </div>
      </div>

      <div class="explore__form__card__btn">
        <button mat-flat-button color="accent" (click)="onSearch()">
          Buscar
        </button>
      </div>
    </mat-card>
  </section>

  <div *ngIf="noResults" class="explore__feedback">
    No s'han trobat dades que coincideixin amb els filtres seleccionats.
  </div>

  <div *ngIf="!noSearch" class="explore--content">
    <div class="explore__observations explore__section">
      <h2>Observacions</h2>
      <p>
        La taula es desplaça cap a l'esquerra en cas d'utilitzar una pantalla
        petita.
      </p>
      <section class="example-container mat-elevation-z8" tabindex="0">
        <table mat-table [dataSource]="speciesData">
          <ng-container matColumnDef="species" sticky>
            <th mat-header-cell *matHeaderCellDef>Espècie</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.species }}
            </td>
          </ng-container>

          <ng-container matColumnDef="amount">
            <th mat-header-cell *matHeaderCellDef>Quantitat</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.amount }}
            </td>
          </ng-container>

          <ng-container matColumnDef="age">
            <th mat-header-cell *matHeaderCellDef>Edat</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.age }}
            </td>
          </ng-container>

          <ng-container matColumnDef="sex">
            <th mat-header-cell *matHeaderCellDef>Sexe</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.sex }}
            </td>
          </ng-container>

          <ng-container matColumnDef="province">
            <th mat-header-cell *matHeaderCellDef>Província</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.province }}
            </td>
          </ng-container>

          <ng-container matColumnDef="location">
            <th mat-header-cell *matHeaderCellDef>Localització</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.location }}
            </td>
          </ng-container>

          <ng-container matColumnDef="latitude">
            <th mat-header-cell *matHeaderCellDef>Latitud</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.latitude }}
            </td>
          </ng-container>

          <ng-container matColumnDef="longitude">
            <th mat-header-cell *matHeaderCellDef>Longitud</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.longitude }}
            </td>
          </ng-container>

          <ng-container matColumnDef="initial_date">
            <th mat-header-cell *matHeaderCellDef>Data d'inici</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.initial_date }}
            </td>
          </ng-container>

          <ng-container matColumnDef="final_date">
            <th mat-header-cell *matHeaderCellDef>Data final</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.final_date }}
            </td>
          </ng-container>

          <ng-container matColumnDef="observer">
            <th mat-header-cell *matHeaderCellDef>Observador/a</th>
            <td mat-cell *matCellDef="let observation">
              {{ observation.observer }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </section>
    </div>

    <div class="explore__distribution explore__section">
      <h2>Distribució</h2>
      <p>
        El mapa mostra tan sols aquelles observacions que tenen registrades
        dades de latitud i longitud.
      </p>
      <div id="exp-map" style="height: 400px; width: 100%"></div>
    </div>

    <div class="explore__evolution explore__section">
      <h2>Evolució</h2>
      <p>
        El gràfic mostra tan sols aquelles observacions que tenen registrades
        les dates.
      </p>
      <br />
      <div class="explore__evolution__graph">
        <canvas id="myChart"></canvas>
      </div>
    </div>
  </div>
</div>
